<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>수비학 생활별 적절한 시기</title>

  <style>
    * {
      box-sizing: border-box;
      margin: 0; 
      padding: 0;
    }
    body {
      font-family: 'Noto Sans', 'Arial', sans-serif;
      line-height: 1.6;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 20px 20px 40px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
      font-size: 1.5rem;
    }

    /* 반응형 그리드: 모바일에서 컬럼이 줄어듦 */
    .input-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    @media (max-width: 600px) {
      .input-section {
        grid-template-columns: 1fr; /* 작은 화면에서는 한 줄씩 */
      }
    }

    .birth-input, .name-input {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
    }
    .birth-input h3,
    .name-input h3 {
      margin-bottom: 10px;
      color: #444;
      font-size: 16px;
      font-weight: 600;
    }

    .date-inputs {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    input[type="text"], 
    input[type="number"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
      font-size: 14px;
    }

    .range-section {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap; /* 모바일에서 줄바꿈 */
    }

    .range-section label {
      font-size: 14px;
      color: #333;
    }

    button {
      width: 100%;
      padding: 14px;
      background: #4F46E5;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-bottom: 20px;
    }
    button:hover {
      background: #4338CA;
    }

    .category-select-wrap {
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    .category-select-wrap label {
      margin-right: 8px;
      font-size: 14px;
      color: #444;
    }
    select {
      padding: 8px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ddd;
      outline: none;
      cursor: pointer;
    }

    .results-section {
      display: none;
    }
    .chart-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      height: auto;
      margin: 0 auto;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 20px;
    }
    /* 캔버스는 고정 크기로 설정 (반응형 지원 시 Chart.js 추천) */
    canvas {
      display: block;
      margin: 0 auto;
      border: 1px solid #f0f0f0;
      width: 100%;
      max-width: 800px;
      height: auto;
    }

    /* 카테고리 상세 정보 */
    .category-info {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 15px;
      display: none;
    }
    .category-info h2 {
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
    }
    .category-info .info-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 12px;
    }
    .category-info .info-box {
      flex: 1 1 30%;
      background: #fff;
      border-radius: 6px;
      padding: 10px;
      border: 1px solid #ddd;
      min-width: 220px;
    }
    .info-box h3 {
      margin-bottom: 6px;
      color: #4F46E5;
      font-size: 14px;
    }
    .info-box p {
      font-size: 13px;
      color: #555;
      line-height: 1.4;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>수비학 생활별 적절한 시기</h1>

  <!-- 이름 입력(계산에는 포함 안 됨) + 양력/음력 -->
  <div class="input-section">
    <!-- 이름 입력 -->
    <div class="name-input">
      <h3>이름</h3>
      <input type="text" id="userName" placeholder="이름을 입력하세요">
    </div>

    <!-- 양력 생년월일 -->
    <div class="birth-input">
      <h3>양력 생년월일</h3>
      <div class="date-inputs">
        <input type="number" id="solarYear" placeholder="년도" min="1900" max="2099">
        <input type="number" id="solarMonth" placeholder="월" min="1" max="12">
        <input type="number" id="solarDay" placeholder="일" min="1" max="31">
      </div>
    </div>
  </div>

  <!-- 추가: 음력 생년월일 -->
  <div class="input-section">
    <div class="birth-input" style="grid-column: 1 / 3;">
      <h3>음력 생년월일</h3>
      <div class="date-inputs">
        <input type="number" id="lunarYear" placeholder="년도" min="1900" max="2099">
        <input type="number" id="lunarMonth" placeholder="월" min="1" max="12">
        <input type="number" id="lunarDay" placeholder="일" min="1" max="31">
      </div>
    </div>
  </div>

  <!-- 연도 범위 -->
  <div class="range-section">
    <label for="rangeStart">시작 연도</label>
    <input type="number" id="rangeStart" placeholder="예: 2025" min="1900" max="2099">
    <label for="rangeEnd">끝 연도</label>
    <input type="number" id="rangeEnd" placeholder="예: 2045" min="1900" max="2099">
  </div>

  <!-- 계산하기 버튼 -->
  <button onclick="calculateFortune()">운세 계산하기</button>

  <!-- 카테고리 드롭다운 -->
  <div class="category-select-wrap">
    <label for="categorySelect">카테고리 선택:</label>
    <select id="categorySelect" onchange="selectCategory(this.value)">
      <option value="">카테고리를 선택하세요</option>
    </select>
  </div>

  <!-- 결과 (그래프) -->
  <div id="results" class="results-section">
    <div class="chart-container">
      <!-- width와 height를 지정해야 Canvas가 정상적으로 차트 렌더링 가능 -->
      <canvas id="scoreChart" width="800" height="400"></canvas>
    </div>
  </div>

  <!-- 카테고리 정보 -->
  <div id="categoryInfo" class="category-info"></div>
</div>

<script>
/************************************************************
 * 1. 데이터 영역
 ************************************************************/
const categories = [
  "이직/취업",
  "이사/부동산",
  "계약/투자",
  "연애/만남",
  "결혼",
  "임신/출산",
  "시험/학업"
];

// 카테고리별 추천 시기
const recommendationsData = {
  "이직/취업": {
    best: {
      years: ["2028 (3/10, 1/9)", "2032 (7/14, 5/13)"],
      months: "3월, 7월, 10월",
      details: "목표 설정과 성취의 기운이 강해 적극적인 변화에 유리합니다."
    },
    good: {
      years: ["2026 (1/8, 9/16)", "2030 (5/12, 3/11)"],
      months: "1월, 5월, 9월",
      details: "안정적으로 자리잡기 쉬운 시기이므로 신중한 준비가 좋습니다."
    },
    avoid: {
      years: ["2027 (2/9, 0/8)", "2029 (4/11, 2/10)"],
      months: "2월, 4월",
      details: "변수나 장애물이 많으므로 관망하는 자세가 필요합니다."
    }
  },
  "이사/부동산": {
    best: {
      years: ["2028 (3/10, 1/9)", "2031 (6/13, 4/12)"],
      months: "3월, 6월, 10월",
      details: "새로운 터전을 마련하기 좋은 시기, 주변 환경 운도 좋습니다."
    },
    good: {
      years: ["2026 (1/8, 9/16)", "2033 (8/15, 6/14)"],
      months: "1월, 8월",
      details: "대체로 무난한 부동산 운이 따라오며, 계약 시 유리할 수 있습니다."
    },
    avoid: {
      years: ["2027 (2/9, 0/8)", "2029 (4/11, 2/10)"],
      months: "2월, 4월, 11월",
      details: "주거 변화에 돌발 상황이 생길 수 있어 신중이 요구됩니다."
    }
  },
  "계약/투자": {
    best: {
      years: ["2028 (3/10, 1/9)", "2034 (9/16, 7/15)"],
      months: "3월, 7월, 9월",
      details: "재물운이 상승하고 시야가 넓어져 성공적 투자가 가능합니다."
    },
    good: {
      years: ["2026 (1/8, 9/16)", "2032 (7/14, 5/13)"],
      months: "1월, 5월, 7월",
      details: "위험도는 낮고 수익은 무난한 편으로 꾸준한 접근이 좋습니다."
    },
    avoid: {
      years: ["2027 (2/9, 0/8)", "2031 (6/13, 4/12)"],
      months: "2월, 6월, 13일",
      details: "판단 착오 가능성이 높아, 위험 관리에 철저해야 합니다."
    }
  },
  "연애/만남": {
    best: {
      years: ["2026 (1/8, 9/16)", "2030 (5/12, 3/11)"],
      months: "1월, 3월, 5월",
      details: "새로운 인연이나 관계 진전에 유리한 시기입니다."
    },
    good: {
      years: ["2028 (3/10, 1/9)", "2033 (8/15, 6/14)"],
      months: "6월, 8월, 10월",
      details: "진지하고 안정적인 만남을 기대할 수 있는 시기입니다."
    },
    avoid: {
      years: ["2029 (4/11, 2/10)", "2031 (6/13, 4/12)"],
      months: "4월, 11월, 13일",
      details: "감정 기복이 커 갈등이 생기기 쉬우므로 신중한 접근이 필요합니다."
    }
  },
  "결혼": {
    best: {
      years: ["2028 (3/10, 1/9)", "2033 (8/15, 6/14)"],
      months: "3월, 6월, 10월",
      details: "결혼운이 매우 좋아 안정적이고 행복한 결실을 기대할 수 있습니다."
    },
    good: {
      years: ["2026 (1/8, 9/16)", "2030 (5/12, 3/11)"],
      months: "1월, 5월, 8월",
      details: "상대와의 의사소통이 잘 맞아 순조로운 결혼 준비가 가능합니다."
    },
    avoid: {
      years: ["2027 (2/9, 0/8)", "2031 (6/13, 4/12)"],
      months: "2월, 4월, 13일",
      details: "행사가 꼬일 수 있으니 신중하게 대비하고 준비 기간을 길게 두세요."
    }
  },
  "임신/출산": {
    best: {
      years: ["2026 (1/8, 9/16)", "2030 (5/12, 3/11)"],
      months: "3월, 5월, 8월",
      details: "신체적·정신적 안정이 유지되어 임신과 출산 운이 가장 좋습니다."
    },
    good: {
      years: ["2028 (3/10, 1/9)", "2033 (8/15, 6/14)"],
      months: "1월, 6월, 10월",
      details: "큰 문제 없이 순조롭게 진행될 수 있는 시기입니다."
    },
    avoid: {
      years: ["2027 (2/9, 0/8)", "2029 (4/11, 2/10)"],
      months: "2월, 4월, 11월",
      details: "건강과 안전에 각별한 주의가 필요한 시기입니다."
    }
  },
  "시험/학업": {
    best: {
      years: ["2028 (3/10, 1/9)", "2030 (5/12, 3/11)"],
      months: "3월, 5월, 10월",
      details: "학습 능률이 최고조에 달해 좋은 성과를 기대할 수 있습니다."
    },
    good: {
      years: ["2026 (1/8, 9/16)", "2032 (7/14, 5/13)"],
      months: "1월, 7월, 9월",
      details: "꾸준한 노력으로 실력을 안정적으로 쌓아갈 수 있는 시기입니다."
    },
    avoid: {
      years: ["2027 (2/9, 0/8)", "2029 (4/11, 2/10)"],
      months: "2월, 4월, 11월",
      details: "집중력이 저하될 수 있으므로 스케줄 관리가 중요합니다."
    }
  }
};

/************************************************************
 * 2. 드롭다운 초기화
 ************************************************************/
function initCategorySelect() {
  const select = document.getElementById('categorySelect');
  select.innerHTML = `<option value="">카테고리를 선택하세요</option>`;
  categories.forEach(cat => {
    const option = document.createElement('option');
    option.value = cat;
    option.textContent = cat;
    select.appendChild(option);
  });
}

/************************************************************
 * 3. 해운(해자운) 계산 함수
 ************************************************************/
function calculateHaeun(year, month, day) {
  const total = parseInt(year) + parseInt(month) + parseInt(day);
  let lastTwo = total % 100;
  let fv = (lastTwo > 21) ? (lastTwo % 10) : lastTwo;
  let sum = 0;
  for (let c of String(total)) {
    sum += parseInt(c, 10);
  }
  return `${fv}/${sum}`;
}

/************************************************************
 * 4. 운세 점수 계산 (예시)
 ************************************************************/
function calculateFortuneScore(haeun) {
  const [first, second] = haeun.split('/').map(Number);
  let score = 70;
  // 좋은 해운
  if ((first === 3 && second === 10) || (first === 7 && second === 14)) {
    score += 20;
  }
  // 나쁜 해운
  if ((first === 2 && second === 9) || (first === 4 && second === 11)) {
    score -= 15;
  }
  return Math.min(100, Math.max(0, score));
}

/************************************************************
 * 5. 해운에 따라 추천 활동 (간단 예시)
 ************************************************************/
function getRecommendations(haeun) {
  if (['3/10', '7/14'].includes(haeun)) return ['이직/취업', '계약/투자'];
  if (['1/8', '5/12'].includes(haeun))  return ['결혼', '이사/부동산'];
  return [];
}

/************************************************************
 * 6. 전역 결과
 ************************************************************/
let globalResults = [];

/************************************************************
 * 7. 메인 계산 함수
 ************************************************************/
function calculateFortune() {
  // 이름은 계산에 포함 X
  const userName = document.getElementById('userName').value || "";

  const solarYear = document.getElementById('solarYear').value;
  const solarMonth = document.getElementById('solarMonth').value;
  const solarDay = document.getElementById('solarDay').value;

  if (!solarYear || !solarMonth || !solarDay) {
    alert('양력 생년월일을 입력해주세요.');
    return;
  }

  const rangeStart = parseInt(document.getElementById('rangeStart').value, 10);
  const rangeEnd = parseInt(document.getElementById('rangeEnd').value, 10);

  if (!rangeStart || !rangeEnd) {
    alert('시작 연도와 끝 연도를 모두 입력해주세요.');
    return;
  }
  if (rangeEnd < rangeStart) {
    alert('끝 연도가 시작 연도보다 같거나 커야 합니다.');
    return;
  }
  if (rangeEnd - rangeStart > 20) {
    alert('최대 20년까지만 계산할 수 있습니다. 범위를 조정해주세요.');
    return;
  }

  // 범위별 결과 계산
  const results = [];
  for (let y = rangeStart; y <= rangeEnd; y++) {
    const haeun = calculateHaeun(y, solarMonth, solarDay);
    const score = calculateFortuneScore(haeun);
    const recos = getRecommendations(haeun);

    results.push({
      year: y,
      haeun,
      score,
      recommendations: recos
    });
  }
  globalResults = results;

  // 결과 보여주기
  document.getElementById('results').style.display = 'block';
  drawLineChart(results);

  // 카테고리 선택 초기화
  initCategorySelect();

  // 카테고리 정보 숨김
  document.getElementById('categoryInfo').style.display = 'none';
  document.getElementById('categoryInfo').innerHTML = '';
}

/************************************************************
 * 8. 라인 차트 그리기
 ************************************************************/
function drawLineChart(results) {
  const canvas = document.getElementById('scoreChart');
  const ctx = canvas.getContext('2d');

  const width = canvas.width;
  const height = canvas.height;

  // 내부 여백
  const margin = { top: 40, right: 40, bottom: 50, left: 60 };
  const chartWidth = width - margin.left - margin.right;
  const chartHeight = height - margin.top - margin.bottom;

  // X/Y축 데이터
  const years = results.map(r => r.year);
  const scores = results.map(r => r.score);

  // 점수 범위 (고정: 0~100)
  const minScore = 0;
  const maxScore = 100;

  // X축 간격
  const xStep = (years.length > 1) 
    ? chartWidth / (years.length - 1) 
    : chartWidth;

  // 배경 지우기
  ctx.clearRect(0, 0, width, height);

  // 배경
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, width, height);

  // 격자선(수평선 5개)
  ctx.strokeStyle = "#ddd";
  ctx.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    const ratio = i / 5;
    const y = margin.top + chartHeight - (chartHeight * ratio);
    ctx.beginPath();
    ctx.moveTo(margin.left, y);
    ctx.lineTo(margin.left + chartWidth, y);
    ctx.stroke();

    // 점수 라벨
    const scoreLabel = (minScore + (maxScore - minScore) * ratio).toFixed(0);
    ctx.fillStyle = "#333";
    ctx.font = "12px Arial";
    ctx.fillText(scoreLabel, margin.left - 30, y + 4);
  }

  // X축
  ctx.beginPath();
  ctx.moveTo(margin.left, margin.top + chartHeight);
  ctx.lineTo(margin.left + chartWidth, margin.top + chartHeight);
  ctx.stroke();

  // 그래프 (라인)
  ctx.strokeStyle = "#4F46E5";
  ctx.lineWidth = 2;
  ctx.beginPath();
  scores.forEach((score, i) => {
    const x = margin.left + xStep * i;
    const yRatio = (score - minScore) / (maxScore - minScore);
    const y = margin.top + (chartHeight - (chartHeight * yRatio));
    if (i === 0) {
      ctx.moveTo(x, y);
    } else {
      ctx.lineTo(x, y);
    }
  });
  ctx.stroke();

  // 각 데이터 점
  scores.forEach((score, i) => {
    const x = margin.left + xStep * i;
    const yRatio = (score - minScore) / (maxScore - minScore);
    const y = margin.top + (chartHeight - (chartHeight * yRatio));

    // 점
    ctx.beginPath();
    ctx.fillStyle = "#4F46E5";
    ctx.arc(x, y, 4, 0, 2 * Math.PI);
    ctx.fill();

    // 라벨 (연도, 점수)
    ctx.fillStyle = "#000";
    ctx.font = "12px Arial";
    ctx.fillText(`${years[i]}년 (${score}점)`, x - 30, y - 10);
  });
}

/************************************************************
 * 9. 카테고리 선택
 ************************************************************/
function selectCategory(category) {
  if (!category) {
    document.getElementById('categoryInfo').style.display = 'none';
    document.getElementById('categoryInfo').innerHTML = '';
    return;
  }
  displayCategoryInfo(category);
}

/************************************************************
 * 10. 카테고리 정보 표시
 ************************************************************/
function displayCategoryInfo(category) {
  const info = document.getElementById('categoryInfo');
  if (!recommendationsData[category]) {
    info.style.display = 'none';
    info.innerHTML = '';
    return;
  }

  const { best, good, avoid } = recommendationsData[category];
  info.style.display = 'block';
  info.innerHTML = `
    <h2>『${category}』 시기별 운세 가이드</h2>
    <div class="info-row">
      <div class="info-box">
        <h3>BEST 시기</h3>
        <p><strong>연도:</strong> ${best.years.join(', ')}</p>
        <p><strong>월:</strong> ${best.months}</p>
        <p>${best.details}</p>
      </div>
      <div class="info-box">
        <h3>GOOD 시기</h3>
        <p><strong>연도:</strong> ${good.years.join(', ')}</p>
        <p><strong>월:</strong> ${good.months}</p>
        <p>${good.details}</p>
      </div>
      <div class="info-box">
        <h3>피해야 할 시기</h3>
        <p><strong>연도:</strong> ${avoid.years.join(', ')}</p>
        <p><strong>월/일:</strong> ${avoid.months}</p>
        <p>${avoid.details}</p>
      </div>
    </div>
  `;
}

/************************************************************
 * 11. 초기화
 ************************************************************/
window.onload = () => {
  initCategorySelect();
  document.getElementById('results').style.display = 'none';
};
</script>
</body>
</html>
